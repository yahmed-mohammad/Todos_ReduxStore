<!DOCTYPE html>
<html>
    <head>
        <title>TODOS & GOALS</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/redux/4.1.2/redux.min.js"></script>
        <script src="https://unpkg.com/react@17.0.2/umd/react.development.js"></script>
        <script src="https://unpkg.com/react-dom@17.0.2/umd/react-dom.development.js"></script>
        <script src="https://unpkg.com/@babel/standalone@7.17.6/babel.min.js"></script>
    </head>
    <body>
        <div>
            <h1> Todo List</h1>
            <input id="todo" type="text" placeholder="Add Todo"/>
            <button id="todoBtn">Add Todo</button>
            <ul id="todos"></ul>
        </div>
        <div>
                <h1> Goal List</h1>
                <input id="goal" type="text" placeholder="Add Goal"/>
                <button id="goalBtn">Add Goal</button>
                <ul id="goals"></ul>
        </div>

        <hr/>

        <div id="app">

        </div>
        <script type="text/javascript">
            const ADD_TODO = "ADD_TODO";
            const REMOVE_TODO = "REMOVE_TODO";
            const TOGGLE_TODO = "TOGGLE_TODO";
            const ADD_GOAL = "ADD_GOAL";
            const REMOVE_GOAL = "REMOVE_GOAL";
            /**
             * 
             * @param {*} state 
             * @param {*} action 
             * Function to handle the todos actions
             */
            function todos(state=[], action) {
                if(action.type === ADD_TODO){
                    return state.concat([action.todo]);
                } else if(action.type === REMOVE_TODO) {
                    return state.filter((todo) => todo.id !== action.id);
                } else if(action.type === TOGGLE_TODO){
                    return state.map((todo) => todo.id !== action.id ? todo : Object.assign({}, todo, {complete: !todo.complete}));
                } else {
                    return state;
                }
                /**We can also write a switch statement here */
            }

            /**
             * 
             * @param {*} state 
             * @param {*} action 
             * Function to handle the goal actions
             */
            function goals(state=[], action) {
                if(action.type === ADD_GOAL){
                    return state.concat([action.goal]);
                } else if(action.type === REMOVE_GOAL) {
                    return state.filter((goal) => goal.id !== action.id);
                } else {
                    return state;
                }
                /**We can also write a switch statement here */
            }

            const store = Redux.createStore(Redux.combineReducers({
                todos,
                goals
            }));
            store.subscribe(() => {
                const {todos, goals} = store.getState();
                document.getElementById('todos').innerHTML= '';
                document.getElementById('goals').innerHTML= '';
                todos.forEach(addTodoUI);
                goals.forEach(addGoalUI);
                //console.log("The new state is:", store.getState());
            });

            function generateId() {
                return (
                Math.random().toString(36).substring(2) +
                new Date().getTime().toString(36)
                );
            }

            function checkAndDispatch(store, action){
                if(action.type === ADD_TODO && action.todo.name.toLowerCase().includes("bitcoin")) {
                    return alert('This is a bad idea!!!')
                } else if(action.type === ADD_GOAL && action.goal.name.toLowerCase().includes("bitcoin")) {
                    return alert('This is a bad idea!!!')
                }
                return store.dispatch(action);
            }

            function addTodo() {
                const input = document.getElementById('todo');
                const name = input.value;
                input.value='';
                const todo= {
                    id: generateId(),
                    name: name,
                    complete: false
                }
                checkAndDispatch(store, addTodoAction(todo));
            }

            function addGoal() {
                const input = document.getElementById('goal');
                const name = input.value;
                input.value='';
                const goal= {
                    id: generateId(),
                    name: name
                }
                checkAndDispatch(store, addGoalAction(goal));
            }

            function addTodoAction(todo) {
                return {
                    type: ADD_TODO,
                    todo: todo
                }
            }
            function toggleTodoAction(id) {
                return {
                    type: TOGGLE_TODO,
                    id: id
                }
            }
            function removeTodoAction(id) {
                return {
                    type: REMOVE_TODO,
                    id: id
                }
            }
            function addGoalAction(goal) {
                return {
                    type: ADD_GOAL,
                    goal: goal
                }
            }
            function removeGoalAction(id) {
                return {
                    type: REMOVE_GOAL,
                    id: id
                }
            }

            document.getElementById('todoBtn').addEventListener('click', addTodo);
            document.getElementById('goalBtn').addEventListener('click', addGoal);

            function createRemoveButton(onClick){
                const removeBtn = document.createElement('button');
                removeBtn.innerHTML = 'X';
                removeBtn.addEventListener('click', onClick);
                return removeBtn;
            }

            function addTodoUI(todo){
                const node = document.createElement('li');
                const text = document.createTextNode(todo.name);
                const removeBtn = createRemoveButton(() => {
                    checkAndDispatch(store, removeTodoAction(todo.id));
                });

                node.appendChild(text);
                node.appendChild(removeBtn);

                node.style.textDecoration = todo.complete ? 'line-through': 'none';
                node.addEventListener('click', () => {
                    checkAndDispatch(store, toggleTodoAction(todo.id));
                });

                document.getElementById('todos').append(node);
            }

            function addGoalUI(goal){
                const node = document.createElement('li');
                const text = document.createTextNode(goal.name);
                const removeBtn = createRemoveButton(() => {
                    checkAndDispatch(store, removeGoalAction(goal.id));
                });
                node.appendChild(text);
                node.appendChild(removeBtn);

                document.getElementById('goals').append(node);
            }
        </script>

        <script type="text/babel">
            const List = (props) => {
                return(
                    <ul>
                        {
                            props.items && props.items.map((item) => (
                                <li key={item.id}><span>{item.name}</span></li>
                            ))
                        }
                    </ul>
                );
            };
            const Todos = (props) => {
                const inputRef = React.useRef();
                const addItem = (event) => {
                    event.preventDefault();
                    const name = inputRef.current.value;
                    inputRef.current.value="";

                    props.store.dispatch(addTodoAction({
                        name,
                        complete: false,
                        id: generateId()
                    }))
                }
                return (
                    <div>
                        <h1>Todos List using REACT</h1>
                        <input type="text" placeholder="Add Todos" ref={inputRef}/>
                        <button onClick={addItem}>Add Todo</button>
                        <List items={props.todos}/>
                    </div>
                );
            };
            const Goals = (props) => {
                const inputRef = React.useRef();
                const addItem = (event) => {
                    event.preventDefault();
                    const name = inputRef.current.value;
                    inputRef.current.value="";

                    props.store.dispatch(addGoalAction({
                        name,
                        id: generateId()
                    }))
                }

                return (
                    <div>
                        <h1>Goals List using REACT</h1>
                        <input type="text" placeholder="Add Goals" ref={inputRef}/>
                        <button onClick={addItem}>Add Goal</button>
                        <List items={props.goals}/>
                    </div>
                );
            };
            const App = (props) => {
                const [value, setValue] = React.useState(0);

                React.useEffect(() => {
                    props.store.subscribe(() => {
                        setValue((value) => value + 1);
                    })
                }, [])

                const {todos, goals} = props.store.getState();

                return (
                    <div>
                        <Todos todos={todos} store={props.store}/>
                        <Goals goals={goals} store={props.store}/>
                    </div>
                );
            };

            ReactDOM.render(<App store={store}/>, document.getElementById("app"));
        </script>
    </body>
</html>